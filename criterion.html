<script src="data.js"></script>
<script>
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  const city = params.get("city");

  const backLink = document.getElementById("backLink");
  backLink.href = city ? `city.html?city=${encodeURIComponent(city)}` : "city.html";

  const contentEl = document.getElementById("content");

  if (!id) {
    contentEl.innerHTML = "<div class='detailCard'>No criterion selected.</div>";
  } else {
    const found = findItemById(id);

    if (!found) {
      contentEl.innerHTML = "<div class='detailCard'>Criterion not found.</div>";
    } else {
      const { pillar, group, item } = found;
      const c = item.content || {};

      function renderList(items, type="ul") {
        if (!items) return "<p class='sectionHint'>Placeholder content.</p>";
        const tag = type === "ol" ? "ol" : "ul";
        return `<${tag} class='${type==="ol"?"numberedList":"bulletList"}'>
          ${items.map(i => `<li>${i}</li>`).join("")}
        </${tag}>`;
      }

      function renderWeightingTable(rows) {
        if (!rows) return "<p class='sectionHint'>Placeholder weighting table.</p>";
        return `
          <div class="tableWrap">
            <table class="dataTable">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Factor A</th>
                  <th>Factor B</th>
                  <th>Factor C</th>
                  <th>Factor D</th>
                  <th>Factor E</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                ${rows.map(r => `
                  <tr>
                    ${r.map(cell => `<td>${cell}</td>`).join("")}
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </div>
        `;
      }

      function renderScoringTable(rows) {
        if (!rows) return "<p class='sectionHint'>Placeholder scoring description.</p>";
        return `
          <div class="tableWrap">
            <table class="dataTable">
              <thead>
                <tr>
                  <th>Score</th>
                  <th>Description</th>
                  <th>Evidence / Examples</th>
                </tr>
              </thead>
              <tbody>
                ${rows.map(r => `
                  <tr>
                    ${r.map(cell => `<td>${cell}</td>`).join("")}
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </div>
        `;
      }

      contentEl.innerHTML = `
        <div class="detailCard">
          <div class="note">${pillar.pillarTitle} â€¢ ${group.groupTitle}</div>
          <h2 class="detailTitle">${item.title}</h2>

          <section class="section">
            <h3 class="sectionTitle">Purpose of the Assessment</h3>
            <p>${c.purpose || "Placeholder purpose content."}</p>
          </section>

          <section class="section">
            <h3 class="sectionTitle">Assessment Framework</h3>
            <p>${c.framework || "Placeholder framework content."}</p>
          </section>

          <section class="section">
            <h3 class="sectionTitle">Data Sources</h3>
            ${renderList(c.dataSources)}
          </section>

          <section class="section">
            <h3 class="sectionTitle">Scoring Process</h3>
            ${renderList(c.scoringProcess, "ol")}
          </section>

          <section class="section">
            <h3 class="sectionTitle">Weighting Table</h3>
            ${renderWeightingTable(c.weightingTable)}
          </section>

          <section class="section">
            <h3 class="sectionTitle">Scoring Description</h3>
            ${renderScoringTable(c.scoringDescription)}
          </section>
        </div>
      `;
    }
  }
</script>
